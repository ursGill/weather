<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather App</title>
  <style>
    :root{
      --bg:#f4f7fb;
      --card:#ffffff;
      --accent:#4f6ef6;
      --alt:#556cd6;
      --muted:#666;
      --radius:14px;
      --shadow: 0 6px 18px rgba(17,24,39,0.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:linear-gradient(180deg,var(--bg),#e9eef6);
      color:#0b1220;
      -webkit-font-smoothing:antialiased;
    }

    .container{
      max-width:720px;
      margin:48px auto;
      padding:20px;
      text-align:center;
    }

    .title{ margin:0 0 18px; font-size:34px; font-weight:700; }

    /* Search row: constrain sizes so buttons are always visible */
    .search {
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      margin-bottom:22px;
      flex-wrap:wrap;
    }

    /* Keep input from taking 100% so buttons remain visible */
    .search input[type=search]{
      flex: 1 1 340px; /* grow, shrink, basis */
      min-width:180px;
      max-width:520px;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid rgba(11,18,32,0.06);
      background:rgba(255,255,255,0.95);
      font-size:15px;
    }

    .btn {
      padding:10px 14px;
      border-radius:10px;
      border:0;
      color:#fff;
      cursor:pointer;
      font-weight:600;
      min-width:110px;
    }

    #search-btn{ background:var(--accent); }
    #loc-btn{ background:var(--alt); }

    /* Card */
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
      display:inline-block;
      min-width:320px;
      max-width:720px;
      text-align:left;
    }

    .card-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .card-header h2{ margin:0; font-size:20px; }
    .card-header small{ color:var(--muted); }

    .weather-row{ display:flex; gap:14px; align-items:center; }
    .icon{ width:84px; height:84px; }
    .temp{ font-size:36px; font-weight:700; }
    .desc{ font-size:15px; color:var(--muted); }

    .meta{ display:flex; gap:12px; list-style:none; padding:0; margin:14px 0 6px; color:var(--muted); }
    .meta li{ font-size:13px; }

    .error{ color:#b00020; margin-top:8px }

    .footer{ margin-top:18px; text-align:center; color:var(--muted); font-size:12px }

    @media (max-width:520px){
      .container{ margin:18px; padding:12px; }
      .icon{ width:68px; height:68px; }
      .search input[type=search]{ flex-basis:220px; }
      .btn{ min-width:96px; padding:8px 10px; }
    }
  </style>
</head>
<body>
  <main class="container">
    <h1 class="title">Weather</h1>

    <form id="search-form" class="search" autocomplete="off">
      <input id="city-input" name="city" type="search" placeholder="Enter city or ZIP" aria-label="City" required>
      <button id="search-btn" class="btn" type="submit">Search</button>
      <button id="loc-btn" class="btn" type="button" title="Use my location">Use my location</button>
    </form>

    <section id="card" class="card" aria-live="polite" style="display:none">
      <div class="card-header">
        <h2 id="location">—</h2>
        <small id="time">—</small>
      </div>

      <div class="weather-row">
        <img id="icon" alt="weather icon" class="icon" src=""/>
        <div style="flex:1">
          <div class="temp" id="temp">—°C</div>
          <div id="desc" class="desc">—</div>
        </div>
      </div>

      <ul class="meta">
        <li>Feels like: <span id="feels">—°C</span></li>
        <li>Humidity: <span id="humidity">—%</span></li>
        <li>Wind: <span id="wind">— m/s</span></li>
      </ul>

      <div id="error" class="error" role="status"></div>
    </section>

    <footer class="footer">
      <small>Data from OpenWeatherMap. Replace <code>API_KEY</code> in the script.</small>
    </footer>
  </main>

  <script>
    // Replace with your OpenWeatherMap API key
    const API_KEY = 'ae5f6c93aeedbcc3324ad636b06e772d';
    const BASE = 'https://api.openweathermap.org/data/2.5/weather';

    const form = document.getElementById('search-form');
    const cityInput = document.getElementById('city-input');
    const locBtn = document.getElementById('loc-btn');
    const card = document.getElementById('card');
    const locationEl = document.getElementById('location');
    const timeEl = document.getElementById('time');
    const iconEl = document.getElementById('icon');
    const tempEl = document.getElementById('temp');
    const descEl = document.getElementById('desc');
    const feelsEl = document.getElementById('feels');
    const humidityEl = document.getElementById('humidity');
    const windEl = document.getElementById('wind');
    const errorEl = document.getElementById('error');

    function showError(msg){
      errorEl.textContent = msg;
      card.style.display = 'block';
    }
    function clearError(){ errorEl.textContent = ''; }
    function showCard(){ card.style.display = 'block'; }

    function formatTime(dt, tzOffsetSeconds){
      const local = new Date((dt + tzOffsetSeconds) * 1000);
      return local.toLocaleString([], { weekday:'short', hour:'2-digit', minute:'2-digit' });
    }

    function setWeather(data){
      clearError();
      showCard();
      const name = `${data.name}${data.sys && data.sys.country ? ', ' + data.sys.country : ''}`;
      locationEl.textContent = name;
      timeEl.textContent = formatTime(data.dt, data.timezone);

      const c = Math.round(data.main.temp);
      tempEl.textContent = `${c}°C`;
      descEl.textContent = data.weather && data.weather[0] ? data.weather[0].description : '';

      feelsEl.textContent = `${Math.round(data.main.feels_like)}°C`;
      humidityEl.textContent = `${data.main.humidity}%`;
      windEl.textContent = `${data.wind.speed} m/s`;

      if(data.weather && data.weather[0]){
        const code = data.weather[0].icon;
        iconEl.src = `https://openweathermap.org/img/wn/${code}@2x.png`;
        iconEl.alt = data.weather[0].description || 'weather icon';
      } else {
        iconEl.src = '';
        iconEl.alt = '';
      }

      try{ localStorage.setItem('lastCity', data.name); } catch(e){}
    }

    async function fetchWeatherByCity(city){
      if(!API_KEY || API_KEY === 'API_KEY'){
        showError('Please add an API key in the script.');
        return;
      }
      clearError();
      showCard();
      locationEl.textContent = 'Loading...';
      tempEl.textContent = '—°C';

      const url = `${BASE}?q=${encodeURIComponent(city)}&units=metric&appid=${API_KEY}`;
      try{
        const res = await fetch(url);
        if(!res.ok){
          if(res.status === 404) throw new Error('City not found');
          throw new Error('Failed to fetch weather');
        }
        const data = await res.json();
        setWeather(data);
      } catch(err){
        showError(err.message);
      }
    }

    async function fetchWeatherByCoords(lat, lon){
      if(!API_KEY || API_KEY === 'API_KEY'){
        showError('Please add an API key in the script.');
        return;
      }
      clearError();
      showCard();
      locationEl.textContent = 'Loading...';
      tempEl.textContent = '—°C';

      const url = `${BASE}?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}`;
      try{
        const res = await fetch(url);
        if(!res.ok) throw new Error('Failed to fetch weather');
        const data = await res.json();
        setWeather(data);
      } catch(err){
        showError(err.message);
      }
    }

    form.addEventListener('submit', e =>{
      e.preventDefault();
      const city = cityInput.value.trim();
      if(!city) return;
      fetchWeatherByCity(city);
    });

    locBtn.addEventListener('click', () =>{
      if(!navigator.geolocation){
        showError('Geolocation not supported by browser');
        return;
      }
      navigator.geolocation.getCurrentPosition(pos =>{
        const {latitude, longitude} = pos.coords;
        fetchWeatherByCoords(latitude, longitude);
      }, err =>{
        showError('Unable to access location');
      }, {timeout:10000});
    });

    window.addEventListener('load', () =>{
      try{
        const last = localStorage.getItem('lastCity');
        if(last){
          cityInput.value = last;
          // do not auto-fetch on load to avoid unexpected location requests; uncomment if you want auto fetch:
          // fetchWeatherByCity(last);
        }
      } catch(e){}
    });
  </script>
</body>
</html>
